
<!DOCTYPE HTML>
<html>
<head>
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>Modular Code for Modular Works of Art  | work and hypertext</title>

<meta name="author" content="Gerardo Veltri"> 

<meta name="description" content="Detailing the goings-on of digital Gerardo."> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="work and hypertext" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/javascripts/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>

	
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">work and hypertext</a></h1>
<h4>efficiency, economy and elegance</h4>
<nav id="main-nav"><ul>
	<li><a href="htt://www.workandtext.com">work and text</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="htt://www.workandtext.com">work and text</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:gveltri.github.io">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<h2 class="title">Modular Code for Modular Works of Art</h2>
	<div class="entry-content"><p>&nbsp;&nbsp;&nbsp; A key feature of Martha Friedman&rsquo;s work is its modularity. Although you won&rsquo;t see people rearranging parts of pieces in the gallery, the human-scale sculptures appear composed of individual objects that are strung through poles or resting on boxes. The digital gallery, however, allows the user to enter an interactive fantasy in which the heavy and delicate pieces can be removed and reaffixed to other supports.</p>

<p><img class="right" src="/images/olive-totem.jpg" width="300" height="500"></p>

<p>&nbsp;&nbsp;&nbsp; Allowing the user to separate objects and rearrange them in a sensible way is an integral part of creating an impactful user experience. Otherwise, a perfectly rendered scene would harly differentiate itself from a photograph, which, along with text, is the artist&rsquo;s medium of choice for representing their artwork. Thus, a logical implementation of cohesion would elevate the gallery in its uniqueness and specificity to the artist&rsquo;s work.</p>

<p>&nbsp;&nbsp;&nbsp; The logic of this mechanic should follow the physical architecture of the sculpture. However it&rsquo;s made in real life should be reflected in the digital environment. <em>Olive Totem</em> (2011) has a cement cube base with a pole perpendicular to the ground. Rubber pimento-stuffed olives are placed at the top of the pole and slid down into place. In the world of computers, we call this a <em>stack</em>. A stack is a collection in which the last added element is the first one removed. Adding to a stack is calling pushing; removing, popping. If one wants to remove a digital olive from the digital armature, it has to be popped from an array of olives where the last olive is the highest on the totem.</p>

<p><img class="left" src="/images/stack.svg" width="300" height="500"></p>

<p>&nbsp;&nbsp;&nbsp; Stacks allow us to conceptualize how the problem might begin to be solved; however, none of the libraries used in this project provide an immediately useable solution to solving this problem. And after hacking away at this problem with my collaborator for a week or so, we discovered that our phsyics engine doesn&rsquo;t support porous meshes. That is&ndash; an olive can&rsquo;t simply have a hole in it and be strung onto the sculpture as in real life. The mechanics of olive stacking must be incorporated in the physics of the environment.</p>

<p>&nbsp;&nbsp;&nbsp; Because we&rsquo;ve already identified this arrangement of pieces as a stack, we know that the mechanics of sculpting will revolve around popping and pushing from an array. There are two majorly important pieces of data in this situation: the array of olives and the armature onto which the olives are &ldquo;snapped&rdquo;. Anyone who knows adobe products well should be familiar with snapping. Snapping is the sometimes-annoying function that moves an object to a specific position when it comes within a certain range of that position. Snapping is how the olives transition between being free objects and anchored to an armature. However, not just any object can be snapped on and off. Only the last object in the array is poppable. Upon initialization this object is pushed to the moveable_objects array, and when it is popped, the next olive is added to the moveable_objects array. The following code is the result of marrying this logic with the environment variables (mouse clicks), 3D models and physics engine.</p>

<p>&nbsp;&nbsp;&nbsp; At the top of my gallery.js, I declared the armature, intersect_cylinder, olives array, and slected_thing as global variables so that they can be accessed by the eventhandlers, the functions that handle user input.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">armature</span><span class="p">,</span> <span class="nx">intersect_cylinder</span><span class="p">,</span> <span class="nx">olives</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">selected_thing</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>&nbsp;&nbsp;&nbsp; When the mouse clicks an object (selected_thing), this bit of code is run. Here, it should unsnap an object if it the selected_thing is the last object in the olives array.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nx">selected_thing</span> <span class="o">==</span> <span class="nx">olives</span><span class="p">[</span><span class="nx">olives</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">olives</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
</span><span class='line'>    <span class="c1">// only makes next olive moveable if it exists</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">olives</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">moveable_objects</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">olives</span><span class="p">[</span><span class="nx">olives</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>When the mouse is unclicked, this bit of code is run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//retrieves coordinates of the mouse click</span>
</span><span class='line'><span class="nx">_vector</span><span class="p">.</span><span class="nx">set</span><span class="p">((</span><span class="nx">evt</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">/</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>      <span class="o">-</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">/</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>      <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//a raycaster returns whatever intersects with the 3D line</span>
</span><span class='line'><span class="c1">//drawn from the camera through the mouse click on the near frustum</span>
</span><span class='line'><span class="nx">raycaster</span><span class="p">.</span><span class="nx">setFromCamera</span><span class="p">(</span><span class="nx">_vector</span><span class="p">,</span> <span class="nx">camera</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">collisionResults</span> <span class="o">=</span> <span class="nx">raycaster</span><span class="p">.</span><span class="nx">intersectObjects</span><span class="p">(</span> <span class="p">[</span><span class="nx">intersect_cylinder</span><span class="p">,</span> <span class="nx">armature</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">olives</span><span class="p">)</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//if the mouse unclicks on any bit of the sculpture,</span>
</span><span class='line'><span class="c1">//the snapping function begins</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span> <span class="nx">collisionResults</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">olives</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">snap_y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">11</span> <span class="o">+</span> <span class="nx">selected_thing</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">boundingSphere</span><span class="p">.</span><span class="nx">radius</span><span class="p">;</span>      
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">snap_y</span> <span class="o">=</span> <span class="nx">olives</span><span class="p">[</span><span class="nx">olives</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span>
</span><span class='line'>      <span class="o">+</span> <span class="nx">olives</span><span class="p">[</span><span class="nx">olives</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">boundingBox</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">x</span>
</span><span class='line'>      <span class="o">+</span> <span class="nx">selected_thing</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">boundingBox</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">selected_thing</span><span class="p">.</span><span class="nx">__dirtyPosition</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//put object in position</span>
</span><span class='line'>    <span class="nx">selected_thing</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="o">=</span><span class="nx">armature</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">selected_thing</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="o">=</span><span class="nx">snap_y</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">selected_thing</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">z</span><span class="o">=</span><span class="nx">armature</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//make object static</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">_v3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">selected_thing</span><span class="p">.</span><span class="nx">setAngularFactor</span><span class="p">(</span><span class="nx">_v3</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">selected_thing</span><span class="p">.</span><span class="nx">setLinearFactor</span><span class="p">(</span><span class="nx">_v3</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">selected_thing</span><span class="p">.</span><span class="nx">setLinearVelocity</span><span class="p">(</span><span class="nx">_v3</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//make last object on olive totem moveable</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">last_index</span> <span class="o">=</span> <span class="nx">moveable_objects</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">olives</span><span class="p">[</span><span class="nx">olives</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>    <span class="nx">moveable_objects</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">last_index</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">moveable_objects</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">selected_thing</span><span class="p">)</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">moveable_objects</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">selected_thing</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// avoids creating duplicates if the object is already in the moveable objects array</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//finally, push selected_thing on the olives stack</span>
</span><span class='line'>    <span class="nx">olives</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">selected_thing</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And with a lot of debugging, it works like a charm.</p>

<p>&nbsp;&nbsp;&nbsp; After playing around a bit in the console, adding new sculptures wherever I saw fit, I discovered a rather annoying problem. When I add another sculpture that has the armature/olive stack feature, I have to duplicate the code above. This code is not designed to scale with new sculptures being added, dynamically or not. Slightly restructuring the logic of this feature will improve the performance of the gallery and its potential for further development. It simply requires refactoring the olives and armature into an object that is then added to an array of globally accessible sculptures.</p>

<p>The resulting global variables are then simply:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">selected_thing</span><span class="p">,</span> <span class="nx">sculptures</span> <span class="o">=</span> <span class="p">[];</span>
</span></code></pre></td></tr></table></div></figure>


<p>And the sculpture object looks something like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">Sculpture</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">armature</span><span class="p">,</span><span class="nx">modules</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">armature</span> <span class="o">=</span> <span class="nx">armature</span><span class="p">;</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">modules</span> <span class="o">=</span> <span class="nx">modules</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">sculptures</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>Which means that everything in the snapping function has to be changed accordingly.</p>

<p>Snapping off:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">sculptures</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">selected_thing</span> <span class="o">==</span> <span class="nx">sculptures</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">modules</span><span class="p">[</span><span class="nx">sculptures</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">modules</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">sculptures</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">modules</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
</span><span class='line'>  <span class="c1">// only makes next olive moveable if it exists</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">sculptures</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">modules</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="nx">moveable_objects</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">sculptures</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">modules</span><span class="p">[</span><span class="nx">sculptures</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">modules</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>  <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And the snapping to:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">sculpture</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">collisionResults</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">_vector</span><span class="p">.</span><span class="nx">set</span><span class="p">((</span><span class="nx">evt</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">/</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>      <span class="o">-</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">/</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>      <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">raycaster</span><span class="p">.</span><span class="nx">setFromCamera</span><span class="p">(</span><span class="nx">_vector</span><span class="p">,</span> <span class="nx">camera</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//iterates through sculpture objects</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">sculptures</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">collisionResults</span> <span class="o">=</span> <span class="nx">raycaster</span><span class="p">.</span><span class="nx">intersectObjects</span><span class="p">(</span><span class="nx">sculptures</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">modules</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">sculptures</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">armature</span><span class="p">));</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">collisionResults</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">sculpture</span> <span class="o">=</span> <span class="nx">sculptures</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span><span class='line'>  <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span> <span class="nx">collisionResults</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">sculpture</span><span class="p">.</span><span class="nx">modules</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">snap_y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">11</span> <span class="o">+</span> <span class="nx">selected_thing</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">boundingSphere</span><span class="p">.</span><span class="nx">radius</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">snap_y</span> <span class="o">=</span> <span class="nx">sculpture</span><span class="p">.</span><span class="nx">modules</span><span class="p">[</span><span class="nx">sculpture</span><span class="p">.</span><span class="nx">modules</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span>
</span><span class='line'>      <span class="o">+</span> <span class="nx">sculpture</span><span class="p">.</span><span class="nx">modules</span><span class="p">[</span><span class="nx">sculpture</span><span class="p">.</span><span class="nx">modules</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">boundingBox</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">x</span>
</span><span class='line'>      <span class="o">+</span> <span class="nx">selected_thing</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">boundingBox</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">selected_thing</span><span class="p">.</span><span class="nx">__dirtyPosition</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//put object in position</span>
</span><span class='line'>    <span class="nx">selected_thing</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="o">=</span><span class="nx">sculpture</span><span class="p">.</span><span class="nx">armature</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">selected_thing</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="o">=</span><span class="nx">snap_y</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">selected_thing</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">z</span><span class="o">=</span><span class="nx">sculpture</span><span class="p">.</span><span class="nx">armature</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//make object static</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">_v3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">selected_thing</span><span class="p">.</span><span class="nx">setAngularFactor</span><span class="p">(</span><span class="nx">_v3</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">selected_thing</span><span class="p">.</span><span class="nx">setLinearFactor</span><span class="p">(</span><span class="nx">_v3</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">selected_thing</span><span class="p">.</span><span class="nx">setLinearVelocity</span><span class="p">(</span><span class="nx">_v3</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//make last object on sculpture stack moveable</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">last_index</span> <span class="o">=</span> <span class="nx">moveable_objects</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">sculpture</span><span class="p">.</span><span class="nx">modules</span><span class="p">[</span><span class="nx">sculpture</span><span class="p">.</span><span class="nx">modules</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>    <span class="nx">moveable_objects</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">last_index</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">moveable_objects</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">selected_thing</span><span class="p">)</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">moveable_objects</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">selected_thing</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// avoids creating duplicates if the object is already in the moveable objects array</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//finally, push selected_thing on the sculpture stack</span>
</span><span class='line'>    <span class="nx">sculpture</span><span class="p">.</span><span class="nx">modules</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">selected_thing</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">//end snapping</span>
</span><span class='line'>
</span><span class='line'><span class="nx">selected_thing</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>&nbsp;&nbsp;&nbsp; Because I&rsquo;ve now folded the armature and olives into an object, I can further refactor the code to include logic specific to the piece. Moving forward, I plan to include new mechanics beyond stacking and animating the snapping and desnapping so as to enhance the user&rsquo;s experience.</p>

<p>&nbsp;&nbsp;&nbsp; Also, those damn olives need to be properly modeled.</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-09-02T15:22:49-04:00" pubdate data-updated="true"></time></div>
	


	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
<!---	<a class="addthis_counter addthis_pill_style"></a> --->
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    Gerardo Veltri

<br>
Powered by Octopress.
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>
